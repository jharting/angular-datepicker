!function(a,b){"use strict";var c;c="object"==typeof exports&&"undefined"!=typeof module?module.exports=b(require("angular"),require("moment")):"function"==typeof define&&define.amd?define(["angular","moment"],b):b(a.angular,a.moment)}(this,function(a,b){a.module||(a=window.angular);var c=a.module("datePicker",[]);c.constant("datePickerConfig",{template:"templates/datepicker.html",view:"month",views:["year","month","date","hours","minutes"],momentNames:{year:"year",month:"month",date:"day",hours:"hours",minutes:"minutes"},viewConfig:{year:["years","isSameYear"],month:["months","isSameMonth"],hours:["hours","isSameHour"],minutes:["minutes","isSameMinutes"]},step:5}),c.filter("mFormat",function(){return function(a,c,d){return b.isMoment(a)?d?b.tz(a,d).format(c):a.format(c):b(a).format(c)}}),c.directive("datePicker",["datePickerConfig","datePickerUtils","$interpolate",function(c,d,e){return{require:"?ngModel",template:'<div ng-include="template"></div>',scope:{model:"=?datePicker",after:"=?",before:"=?",highlights:"=?"},link:function(f,g,h,i){function j(){f.views=c.views.concat(),f.view=h.view||c.view,f.views=f.views.slice(f.views.indexOf(h.maxView||"year"),f.views.indexOf(h.minView||"minutes")+1),1!==f.views.length&&-1!==f.views.indexOf(f.view)||(f.view=f.views[0])}function k(a){return d.getDate(f,h,a)}function l(){var a=f.view;d.setParams(v,G),f.model&&!u&&(f.date=w(f.model),u=!1);var b=f.date;switch(a){case"year":f.years=d.getVisibleYears(b);break;case"month":f.months=d.getVisibleMonths(b);break;case"date":f.weekdays=f.weekdays||d.getDaysOfWeek(),f.weeks=d.getVisibleWeeks(b);break;case"hours":f.hours=d.getVisibleHours(b);break;case"minutes":f.minutes=d.getVisibleMinutes(b,y)}o()}function m(){return"date"!==f.view?f.view:f.date?f.date.month():null}var n,o,p,q,r,s,t,u=!1,v=f.tz=h.timezone,w=d.createMoment,x=d.eventIsForPicker,y=parseInt(h.step||c.step,10),z=!!h.partial,A=k("minDate"),B=k("maxDate"),C=e(g[0].id)(f),D=f.now=w(),E=f.date=w(f.model||D),F="true"===h.autoClose,G=h.firstDay&&h.firstDay>=0&&h.firstDay<=6?parseInt(h.firstDay,10):b().weekday(0).day();d.setParams(v,G),f.model||E.minute(Math.ceil(E.minute()/y)*y).second(0),f.template=h.template||c.template,f.watchDirectChanges=void 0!==h.watchDirectChanges,f.callbackOnSetDate=h.dateChange?d.findFunction(f,h.dateChange):void 0,j(),f.setView=function(a){-1!==f.views.indexOf(a)&&(f.view=a)},f.selectDate=function(a){if(h.disabled)return!1;if(p(f.date,a)&&(a=f.date),a=q(a),!a)return!1;f.date=a;var b=f.views[f.views.indexOf(f.view)+1];(!b||z||f.model)&&n(a,!0),b?f.setView(b):F?(g.addClass("hidden"),f.$emit("hidePicker")):o()},n=function(b,c){b&&((0!==f.model&&"date-picker"!==h.datePicker||!a.isDefined(f.model)&&!a.isDefined(h.datePicker))&&(f.model=b),i&&i.$setViewValue(b)),f.$emit("setDate",f.model,f.view,c),f.callbackOnSetDate&&f.callbackOnSetDate(h.datePicker,f.date,c)},f.$watch(m,l),f.watchDirectChanges&&f.$watch("model",function(){u=!1,l()}),a.isDefined(h.highlights)&&f.$watchCollection("highlights",function(c){if(a.isDefined(c)){if(!a.isArray(c))throw new Error("Invalid highlights object "+c);t=c.map(function(a){return b(a)}),l()}}),o=function(){var a,b,e,g=f.view,h=f.date,i=[],j="";if(d.setParams(v,G),"date"===g){var k,l=f.weeks;for(a=0;a<l.length;a++)for(k=l[a],i.push([]),b=0;b<k.length;b++){if(j="",d.isSameDay(h,k[b])&&(j+="active"),r(k[b],g)&&(j+=" now"),k[b].month()===h.month()&&s(k[b])||(j+=" disabled"),t&&t.length&&!j.length)for(e=0;e<t.length;e++)if(d.isSameDay(t[e],k[b])){j+=" highlighted";break}i[a].push(j)}}else{var m=c.viewConfig[g],n=f[m[0]],o=m[1];for(a=0;a<n.length;a++)j="",d[o](h,n[a])&&(j+="active"),r(n[a],g)&&(j+=" now"),s(n[a])||(j+=" disabled"),i.push(j)}f.classes=i},f.next=function(a){var c=b(f.date);switch(a=a||1,f.view){case"year":case"month":c.year(c.year()+a);break;case"date":c.month(c.month()+a);break;case"hours":case"minutes":c.hours(c.hours()+a)}c=q(c),c&&(f.date=c,n(c,!1),u=!0,l())},s=function(a){var b=!0;return A&&A.isAfter(a)&&(b=p(A,a)),B&&B.isBefore(a)&&(b&=p(B,a)),b},p=function(a,b){return!!a.isSame(b,c.momentNames[f.view])},q=function(a){return A&&A.isAfter(a)?A:B&&B.isBefore(a)?B:a},r=function(a,b){var c=!0;switch(b){case"minutes":c&=~~(D.minutes()/y)===~~(a.minutes()/y);case"hours":c&=D.hours()===a.hours();case"date":c&=D.date()===a.date();case"month":c&=D.month()===a.month();case"year":c&=D.year()===a.year()}return c},f.prev=function(a){return f.next(-a||-1)},C&&f.$on("pickerUpdate",function(b,c,d){if(x(c,C)){var e=!1,g=!1;a.isDefined(d.minDate)&&(A=d.minDate?d.minDate:!1,g=!0),a.isDefined(d.maxDate)&&(B=d.maxDate?d.maxDate:!1,g=!0),a.isDefined(d.minView)&&(h.minView=d.minView,e=!0),a.isDefined(d.maxView)&&(h.maxView=d.maxView,e=!0),a.isDefined(d.timezone)&&(v=f.tz=d.timezone,g=!0),h.view=d.view||h.view,e&&j(),g&&l()}})}}}]),a.module("datePicker").factory("datePickerUtils",function(){var c,d,e=function(a,d,e,f,g){var h=Date.UTC(0|a,0|d,0|e,0|f,0|g);return c?b.tz(h,c):b(h)};return{getVisibleMinutes:function(a,b){var c,d,f=a.year(),g=a.month(),h=a.date(),i=a.hours(),j=a.utcOffset()/60,k=[];for(d=0;60>d;d+=b)c=e(f,g,h,i-j,d),k.push(c);return k},getVisibleWeeks:function(a){a=b(a);var c=a.year(),e=a.month();a.date(1);var f=a.day();a.date(d-(f+(d>=f?6:-1)));for(var g=[];g.length<6&&!(a.year()===c&&a.month()>e);)g.push(this.getDaysOfWeek(a)),a.add(7,"d");return g},getVisibleYears:function(a){var c=b(a),d=c.year();c.year(d-d%10),d=c.year();for(var f,g,h=c.utcOffset()/60,i=[],j=0;12>j;j++)f=e(d,0,1,0-h),g=f.utcOffset()/60,g!==h&&(f=e(d,0,1,0-g),h=g),i.push(f),d++;return i},getDaysOfWeek:function(a){a=a?a:c?b.tz(c).day(d):b().day(d);for(var f,g,h=a.year(),i=a.month(),j=a.date(),k=[],l=a.utcOffset()/60,m=0;7>m;m++)f=e(h,i,j,0-l,0,!1),g=f.utcOffset()/60,g!==l&&(f=e(h,i,j,0-g,0,!1)),k.push(f),j++;return k},getVisibleMonths:function(a){for(var b,c,d=a.year(),f=a.utcOffset()/60,g=[],h=0;12>h;h++)b=e(d,h,1,0-f,0,!1),c=b.utcOffset()/60,c!==f&&(b=e(d,h,1,0-c,0,!1)),g.push(b);return g},getVisibleHours:function(a){var b,c,d,f=a.year(),g=a.month(),h=a.date(),i=[],j=a.utcOffset()/60;for(b=0;24>b;b++)c=e(f,g,h,b-j,0,!1),d=c.utcOffset()/60,d!==j&&(c=e(f,g,h,b-d,0,!1)),i.push(c);return i},isAfter:function(a,b){return a&&a.unix()>=b.unix()},isBefore:function(a,b){return a.unix()<=b.unix()},isSameYear:function(a,b){return a&&a.year()===b.year()},isSameMonth:function(a,b){return this.isSameYear(a,b)&&a.month()===b.month()},isSameDay:function(a,b){return this.isSameMonth(a,b)&&a.date()===b.date()},isSameHour:function(a,b){return this.isSameDay(a,b)&&a.hours()===b.hours()},isSameMinutes:function(a,b){return this.isSameHour(a,b)&&a.minutes()===b.minutes()},setParams:function(a,b){c=a,d=b},scopeSearch:function(a,b,c){var d,e,f=a,g=b.split("."),h=g.length;do{for(d=f=f.$parent,e=0;h>e;e++){d=d[g[e]]}if(d&&c(d))return d}while(f.$parent);return!1},findFunction:function(b,c){return this.scopeSearch(b,c,function(b){return a.isFunction(b)})},findParam:function(a,b){return this.scopeSearch(a,b,function(){return!0})},createMoment:function(a){return c?b.tz(a,c):b.isMoment(a)?b.unix(a.unix()):b(a)},getDate:function(a,b,c){var d=!1;return b[c]&&(d=this.createMoment(b[c]),d.isValid()||(d=this.findParam(a,b[c]),d&&(d=this.createMoment(d)))),d},eventIsForPicker:function(b,c){function d(a){return a instanceof RegExp?a.test(c):a===c}return a.isArray(b)?b.some(d):d(b)}}});var c=a.module("datePicker");c.directive("dateRange",["$compile","datePickerUtils","dateTimeConfig",function(c,d,e){function f(c,d,f,g,h){return e.template(a.extend(c,{ngModel:f,minDate:g&&b.isMoment(g)?g.format():!1,maxDate:h&&b.isMoment(h)?h.format():!1}),d)}function g(){return"picker"+Math.random().toString().substr(2)}return{scope:{start:"=",end:"="},link:function(b,e,h){function i(a){b.$broadcast("pickerUpdate",m[0],{maxDate:a})}function j(a){b.$broadcast("pickerUpdate",m[1],{minDate:a})}var k=null,l=e[0].id,m=[g(),g()],n=d.createMoment,o=d.eventIsForPicker;b.dateChange=function(a,b){k&&k(a,b)},l&&b.$on("pickerUpdate",function(a,c,d){o(c,l)&&b.$broadcast("pickerUpdate",m,d)}),d.setParams(h.timezone),b.start=n(b.start),b.end=n(b.end),b.$watchGroup(["start","end"],function(a){j(a[0]),i(a[1])}),a.isDefined(h.dateChange)&&(k=d.findFunction(b,h.dateChange)),h.onSetDate="dateChange";var p='<div><table class="date-range"><tr><td valign="top">'+f(h,m[0],"start",!1,b.end)+'</td><td valign="top">'+f(h,m[1],"end",b.start,!1)+"</td></tr></table></div>",q=c(p)(b);e.append(q)}}}]);var d="ng-pristine",e="ng-dirty",c=a.module("datePicker");c.constant("dateTimeConfig",{template:function(a,b){return"<div "+(b?'id="'+b+'" ':"")+'date-picker="'+a.ngModel+'" '+(a.view?'view="'+a.view+'" ':"")+(a.maxView?'max-view="'+a.maxView+'" ':"")+(a.maxDate?'max-date="'+a.maxDate+'" ':"")+(a.autoClose?'auto-close="'+a.autoClose+'" ':"")+(a.template?'template="'+a.template+'" ':"")+(a.minView?'min-view="'+a.minView+'" ':"")+(a.minDate?'min-date="'+a.minDate+'" ':"")+(a.partial?'partial="'+a.partial+'" ':"")+(a.step?'step="'+a.step+'" ':"")+(a.onSetDate?'date-change="'+a.onSetDate+'" ':"")+(a.ngModel?'ng-model="'+a.ngModel+'" ':"")+(a.firstDay?'first-day="'+a.firstDay+'" ':"")+(a.timezone?'timezone="'+a.timezone+'" ':"")+(a.highlights?'highlights="'+a.highlights+'" ':"")+'class="date-picker-date-time"></div>'},format:"YYYY-MM-DD HH:mm",views:["date","year","month","hours","minutes"],autoClose:!1,position:"relative"}),c.directive("dateTimeAppend",function(){return{link:function(a,b){b.bind("click",function(){b.find("input")[0].focus()})}}}),c.directive("dateTime",["$compile","$document","$filter","dateTimeConfig","$parse","datePickerUtils","$interpolate",function(c,f,g,h,i,j,k){var l=f.find("body"),m=g("mFormat");return{require:"ngModel",scope:!0,link:function(f,g,n,o){function p(a){return m(a,y,M)}function q(a){var c=b(a,y);return c.isValid()?c:void 0}function r(a){I=a,n.minDate=a?a.format():a,J=b.isMoment(a)}function s(a){K=a,n.maxDate=a?a.format():a,L=b.isMoment(a)}function t(){x=h.template(n)}function u(a){a.stopPropagation(),o.$pristine&&(o.$dirty=!0,o.$pristine=!1,g.removeClass(d).addClass(e),z&&z.$setDirty(),o.$render())}function v(){E&&(E.remove(),E=null),H&&(H.remove(),H=null)}function w(){if(!E){if(E=c(x)(f),f.$digest(),P||(f.$on("setDate",function(a,b,c,d){u(a),O&&O(n.ngModel,b,d),D&&A[A.length-1]===c&&v()}),f.$on("hidePicker",function(){g.triggerHandler("blur")}),f.$on("$destroy",v),P=!0),"absolute"===G){var b=g[0].getBoundingClientRect(),d=b.height||g[0].offsetHeight;E.css({top:b.top+d+"px",left:b.left+"px",display:"block",position:G}),l.append(E)}else H=a.element("<div date-picker-wrapper></div>"),g[0].parentElement.insertBefore(H[0],g[0]),H.append(E),E.css({top:g[0].offsetHeight+"px",display:"block"});E.bind("mousedown",function(a){a.preventDefault()})}}var x,y=n.format||h.format,z=g.inheritedData("$formController"),A=i(n.views)(f)||h.views.concat(),B=n.view||A[0],C=A.indexOf(B),D=n.autoClose?i(n.autoClose)(f):h.autoClose,E=null,F=k(g[0].id)(f),G=n.position||h.position,H=null,I=null,J=null,K=null,L=null,M=n.timezone||!1,N=j.eventIsForPicker,O=null,P=!1;-1===C&&A.splice(C,1),A.unshift(B),o.$formatters.push(p),o.$parsers.unshift(q),a.isDefined(n.minDate)&&(r(j.findParam(f,n.minDate)),o.$validators.min=function(a){return J?b.isMoment(a)&&(I.isSame(a)||I.isBefore(a)):!0}),a.isDefined(n.maxDate)&&(s(j.findParam(f,n.maxDate)),o.$validators.max=function(a){return L?b.isMoment(a)&&(K.isSame(a)||K.isAfter(a)):!0}),a.isDefined(n.dateChange)&&(O=j.findFunction(f,n.dateChange)),F&&f.$on("pickerUpdate",function(b,c,d){if(N(c,F))if(E);else{var e=!1;a.isDefined(d.minDate)&&(r(d.minDate),e=!0),a.isDefined(d.maxDate)&&(s(d.maxDate),e=!0),a.isDefined(d.minView)&&(n.minView=d.minView),a.isDefined(d.maxView)&&(n.maxView=d.maxView),a.isDefined(d.timezone)&&(M=n.timezone=d.timezone,e=!0),n.view=d.view||n.view,e&&o.$validate(),a.isDefined(d.format)&&(y=n.format=d.format||h.format,o.$modelValue=-1),t()}}),g.bind("focus",w),g.bind("blur",v),t()}}}]),a.module("datePicker").run(["$templateCache",function(a){a.put("templates/datepicker.html",'<div ng-switch="view">\n  <div ng-switch-when="date">\n    <table>\n      <thead>\n      <tr>\n        <th ng-click="prev()">&lsaquo;</th>\n        <th colspan="5" class="switch" ng-click="setView(\'month\')" ng-bind="date|mFormat:\'YYYY MMMM\':tz"></th>\n        <th ng-click="next()">&rsaquo;</i></th>\n      </tr>\n      <tr>\n        <th ng-repeat="day in weekdays" style="overflow: hidden" ng-bind="day|mFormat:\'ddd\':tz"></th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr ng-repeat="week in weeks" ng-init="$index2 = $index">\n        <td ng-repeat="day in week">\n          <span\n            ng-class="classes[$index2][$index]"\n            ng-click="selectDate(day)" ng-bind="day|mFormat:\'DD\':tz"></span>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n  </div>\n  <div ng-switch-when="year">\n    <table>\n      <thead>\n      <tr>\n        <th ng-click="prev(10)">&lsaquo;</th>\n        <th colspan="5" class="switch"ng-bind="years[0].year()+\' - \'+years[years.length-1].year()"></th>\n        <th ng-click="next(10)">&rsaquo;</i></th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr>\n        <td colspan="7">\n          <span ng-class="classes[$index]"\n                ng-repeat="year in years"\n                ng-click="selectDate(year)" ng-bind="year.year()"></span>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n  </div>\n  <div ng-switch-when="month">\n    <table>\n      <thead>\n      <tr>\n        <th ng-click="prev()">&lsaquo;</th>\n        <th colspan="5" class="switch" ng-click="setView(\'year\')" ng-bind="date|mFormat:\'YYYY\':tz"></th>\n        <th ng-click="next()">&rsaquo;</i></th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr>\n        <td colspan="7">\n          <span ng-repeat="month in months"\n                ng-class="classes[$index]"\n                ng-click="selectDate(month)"\n                ng-bind="month|mFormat:\'MMM\':tz"></span>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n  </div>\n  <div ng-switch-when="hours">\n    <table>\n      <thead>\n      <tr>\n        <th ng-click="prev(24)">&lsaquo;</th>\n        <th colspan="5" class="switch" ng-click="setView(\'date\')" ng-bind="date|mFormat:\'DD MMMM YYYY\':tz"></th>\n        <th ng-click="next(24)">&rsaquo;</i></th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr>\n        <td colspan="7">\n          <span ng-repeat="hour in hours"\n                ng-class="classes[$index]"\n                ng-click="selectDate(hour)" ng-bind="hour|mFormat:\'HH:mm\':tz"></span>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n  </div>\n  <div ng-switch-when="minutes">\n    <table>\n      <thead>\n      <tr>\n        <th ng-click="prev()">&lsaquo;</th>\n        <th colspan="5" class="switch" ng-click="setView(\'hours\')" ng-bind="date|mFormat:\'DD MMMM YYYY\':tz"></th>\n        <th ng-click="next()">&rsaquo;</i></th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr>\n        <td colspan="7">\n          <span ng-repeat="minute in minutes"\n                ng-class="classes[$index]"\n                ng-click="selectDate(minute)"\n                ng-bind="minute|mFormat:\'HH:mm\':tz"></span>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n  </div>\n</div>')}])});